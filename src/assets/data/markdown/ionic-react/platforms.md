# Lab: Add Capacitor Platforms

In this lab, you will learn how to:

- Update the application's Capacitor configuration
- Add the iOS and Android platforms to the application
- Update the application's splash screen and application icon
- Build and run the application on both platforms

## Update the Configuration

When a platform is added or updated to a Capacitor project, information in `capacitor.config.ts` is used to generate some information within the project files. Some of this information should be changed up front:

- The `appId` should be changed to something unique like `com.mycompany.teataster`
- `appName` should be changed to the application's display name

**Example:**

```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'io.ionic.teataster',
  appName: 'Tea Tasting Notes',
  webDir: 'dist',
  bundledWebRuntime: false,
};

export default config;
```

These values can be changed after the platforms have been generated by updating this file _and_ the native projects. It is easiest to do this now before any native projects have been created.

Make similar changes to your application.

## Add the Android and iOS Platforms

Before adding any Capacitor platforms, you need to make sure that your application has been built. If it has not been built, the `dist` folder will not exist and the attempt to add the platform will fail.

```bash
$ npm run build
```

Now you can add both the Android and iOS platforms.

```bash
$ ionic cap add android
$ ionic cap add ios
```

Once the platforms are added, open the native projects, each in their own IDE.

```bash
$ ionic cap open android
$ ionic cap open ios
```

**Note:** You need to have Android Studio installed if you want to build on Android. You need to be using a Mac that has Xcode properly installed in order to build for iOS.

## Update the Splash Screen and Application Icon

Capacitor has a tool called <a href="https://www.npmjs.com/package/@capacitor/assets" target="_blank">`@capacitor/assets`</a> that creates all of the icons that the native applications need. This tool will also generate the icons that are needed if we decide to deploy our application as a PWA.

In order to use this tool, we need to install it as a dev dependency:

```bash
npm i -D @capacitor/assets
```

Next, get the source image files that we need. Note that this is just our "product logo" in two versions, one for light mode and one for dark mode. Dark mode is optional.

- Create a `resources` directory at the root level of the application (`mkdir resources`)
- Download the following images to the newly created `resources` directory
  - <a download href="/assets/packages/ionic-react/logo.png">logo.png</a>
  - <a download href="/assets/packages/ionic-react/logo-dark.png">logo-dark.png</a>

To generate the required resources and copy them to the native projects, use the following command:

```bash
npx capacitor-assets generate --iconBackgroundColor '#f1ebe1' --splashBackgroundColor '#f1ebe1' --iconBackgroundColorDark '#110b00' --splashBackgroundColorDark '#110b00'
```

**Pro Tip:** the `@capacitor/assets` package is updated from time to time. As a result, you may want to regenerate the icons and splash screen from time to time. To make this easier, add the command to your `package.json` `scripts`:

```json
  "scripts": {
    "assets": "capacitor-assets generate --iconBackgroundColor '#f1ebe1' --splashBackgroundColor '#f1ebe1' --iconBackgroundColorDark '#110b00' --splashBackgroundColorDark '#110b00'",
    ...
  },
```

When you want to regenerate the assets, you just need to remember `npm run assets`, and not the whole `capacitor-assets` command.

## Update NPM Scripts

I like to have my build do a copy for me. For this reason, I do a `cap copy` with every build. This ensures my native projects are always up to date with the latest changes made.

```json
  "scripts": {
    "build": "tsc && vite build && cap copy",
    ...
  },
```

At this point, run `npm run build` and then open either the Android or iOS native project and run the application on device or emulator. The application should have the updated icon as well as the new splash screen, and it should run normally.

Stage all of your files and commit them to the git repo at this point (I suggest doing that at the end of every lab).

## Live Reload (Optional)

Now that the projects are set up and building properly, you can make use of Capacitor's "live reload" feature if you would like to. Live reload allows you to run the application on your device and will re-build and reload the application as you develop. This is similar to `ionic serve`, but is running the application on device instead of the browser.

```bash
$ ionic cap run android --livereload --external
$ ionic cap run ios --livereload --external
```

These commands start a dev server that monitors changes to the Ionic Framework project, launches the proper IDE, and allows you to run the application on device. Once that is done, when you change code in the Ionic Framework project, it will be rebuilt and reloaded on the device(s).

## Conclusion

In this lab we learned how to configure our Capacitor project, add iOS and Android platforms, and how to build the application for those platforms. Next we will learn how to access native functionality with our application.
